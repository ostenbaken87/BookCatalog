<?php

use yii\db\Migration;

/**
 * Миграция для добавления тестовых данных - книг для всех авторов
 */
class m241020_000008_add_test_books_data extends Migration
{
    public function safeUp()
    {
        $time = time();
        
        // Книги Льва Толстого (author_id = 1)
        $tolstoyBooks = [
            [
                'title' => 'Анна Каренина',
                'year' => 1877,
                'description' => 'Роман о трагической любви замужней дамы Анны Карениной и блестящего офицера графа Вронского.',
                'isbn' => '978-5-17-098354-3',
            ],
            [
                'title' => 'Воскресение',
                'year' => 1899,
                'description' => 'Последний роман Льва Толстого, рассказывающий о духовном возрождении человека.',
                'isbn' => '978-5-17-098355-0',
            ],
            [
                'title' => 'Смерть Ивана Ильича',
                'year' => 1886,
                'description' => 'Повесть о чиновнике, который перед лицом смерти переосмысливает всю свою жизнь.',
                'isbn' => '978-5-17-098356-7',
            ],
        ];

        foreach ($tolstoyBooks as $book) {
            $this->insert('{{%book}}', array_merge($book, [
                'created_at' => $time,
                'updated_at' => $time,
            ]));
            $bookId = $this->db->getLastInsertID();
            $this->insert('{{%book_author}}', ['book_id' => $bookId, 'author_id' => 1]);
        }

        // Книги Достоевского (author_id = 2)
        $dostoevskiBooks = [
            [
                'title' => 'Идиот',
                'year' => 1869,
                'description' => 'Роман о князе Мышкине - «положительно прекрасном человеке» в современном мире.',
                'isbn' => '978-5-17-098357-4',
            ],
            [
                'title' => 'Братья Карамазовы',
                'year' => 1880,
                'description' => 'Последний роман Достоевского, философское произведение о вере, сомнении и человеческой природе.',
                'isbn' => '978-5-17-098358-1',
            ],
            [
                'title' => 'Бесы',
                'year' => 1872,
                'description' => 'Роман о политических радикалах и их влиянии на общество.',
                'isbn' => '978-5-17-098359-8',
            ],
            [
                'title' => 'Игрок',
                'year' => 1866,
                'description' => 'Повесть о страсти к азартным играм и её разрушительном влиянии.',
                'isbn' => '978-5-17-098360-4',
            ],
        ];

        foreach ($dostoevskiBooks as $book) {
            $this->insert('{{%book}}', array_merge($book, [
                'created_at' => $time,
                'updated_at' => $time,
            ]));
            $bookId = $this->db->getLastInsertID();
            $this->insert('{{%book_author}}', ['book_id' => $bookId, 'author_id' => 2]);
        }

        // Книги Чехова (author_id = 3)
        $chekhovBooks = [
            [
                'title' => 'Вишнёвый сад',
                'year' => 1904,
                'description' => 'Пьеса о судьбе дворянской усадьбы и её обитателей в эпоху перемен.',
                'isbn' => '978-5-17-098361-1',
            ],
            [
                'title' => 'Три сестры',
                'year' => 1901,
                'description' => 'Драма о трёх сёстрах, мечтающих вернуться в Москву.',
                'isbn' => '978-5-17-098362-8',
            ],
            [
                'title' => 'Дядя Ваня',
                'year' => 1897,
                'description' => 'Пьеса о жизни в провинциальной усадьбе и несбывшихся надеждах.',
                'isbn' => '978-5-17-098363-5',
            ],
            [
                'title' => 'Чайка',
                'year' => 1896,
                'description' => 'Пьеса о любви, искусстве и трагедии молодого писателя.',
                'isbn' => '978-5-17-098364-2',
            ],
            [
                'title' => 'Палата № 6',
                'year' => 1892,
                'description' => 'Повесть о враче психиатрической больницы и его философских беседах с пациентом.',
                'isbn' => '978-5-17-098365-9',
            ],
        ];

        foreach ($chekhovBooks as $book) {
            $this->insert('{{%book}}', array_merge($book, [
                'created_at' => $time,
                'updated_at' => $time,
            ]));
            $bookId = $this->db->getLastInsertID();
            $this->insert('{{%book_author}}', ['book_id' => $bookId, 'author_id' => 3]);
        }

        // Книги Пушкина (author_id = 4)
        $pushkinBooks = [
            [
                'title' => 'Евгений Онегин',
                'year' => 1833,
                'description' => 'Роман в стихах о жизни русского дворянства начала XIX века.',
                'isbn' => '978-5-17-098366-6',
            ],
            [
                'title' => 'Капитанская дочка',
                'year' => 1836,
                'description' => 'Исторический роман о событиях Пугачёвского восстания.',
                'isbn' => '978-5-17-098367-3',
            ],
            [
                'title' => 'Дубровский',
                'year' => 1833,
                'description' => 'Роман о благородном разбойнике, мстящем за смерть отца.',
                'isbn' => '978-5-17-098368-0',
            ],
            [
                'title' => 'Пиковая дама',
                'year' => 1834,
                'description' => 'Повесть о азартном игроке, одержимом идеей узнать тайну трёх карт.',
                'isbn' => '978-5-17-098369-7',
            ],
            [
                'title' => 'Повести Белкина',
                'year' => 1831,
                'description' => 'Цикл повестей: «Выстрел», «Метель», «Гробовщик», «Станционный смотритель», «Барышня-крестьянка».',
                'isbn' => '978-5-17-098370-3',
            ],
        ];

        foreach ($pushkinBooks as $book) {
            $this->insert('{{%book}}', array_merge($book, [
                'created_at' => $time,
                'updated_at' => $time,
            ]));
            $bookId = $this->db->getLastInsertID();
            $this->insert('{{%book_author}}', ['book_id' => $bookId, 'author_id' => 4]);
        }

        // Книги Лермонтова (author_id = 5)
        $lermontovBooks = [
            [
                'title' => 'Герой нашего времени',
                'year' => 1840,
                'description' => 'Первый психологический роман в русской литературе о судьбе молодого офицера Печорина.',
                'isbn' => '978-5-17-098371-0',
            ],
            [
                'title' => 'Маскарад',
                'year' => 1835,
                'description' => 'Драма о ревности, мести и трагедии в высшем свете.',
                'isbn' => '978-5-17-098372-7',
            ],
            [
                'title' => 'Демон',
                'year' => 1841,
                'description' => 'Поэма о падшем ангеле, влюбившемся в земную девушку.',
                'isbn' => '978-5-17-098373-4',
            ],
            [
                'title' => 'Мцыри',
                'year' => 1840,
                'description' => 'Поэма о юноше, выросшем в монастыре и мечтающем о свободе.',
                'isbn' => '978-5-17-098374-1',
            ],
        ];

        foreach ($lermontovBooks as $book) {
            $this->insert('{{%book}}', array_merge($book, [
                'created_at' => $time,
                'updated_at' => $time,
            ]));
            $bookId = $this->db->getLastInsertID();
            $this->insert('{{%book_author}}', ['book_id' => $bookId, 'author_id' => 5]);
        }

        // Добавим несколько книг с несколькими авторами (соавторство)
        // Например, сборник произведений разных авторов
        $this->insert('{{%book}}', [
            'title' => 'Золотой век русской поэзии',
            'year' => 2020,
            'description' => 'Сборник избранных произведений русских поэтов XIX века.',
            'isbn' => '978-5-17-098375-8',
            'created_at' => $time,
            'updated_at' => $time,
        ]);
        $bookId = $this->db->getLastInsertID();
        // Добавляем Пушкина и Лермонтова как соавторов
        $this->insert('{{%book_author}}', ['book_id' => $bookId, 'author_id' => 4]);
        $this->insert('{{%book_author}}', ['book_id' => $bookId, 'author_id' => 5]);

        echo "Добавлено тестовых книг:\n";
        echo "- Толстой: 3 книги\n";
        echo "- Достоевский: 4 книги\n";
        echo "- Чехов: 5 книг\n";
        echo "- Пушкин: 5 книг\n";
        echo "- Лермонтов: 4 книги\n";
        echo "- Сборник (Пушкин + Лермонтов): 1 книга\n";
        echo "Всего добавлено: 22 книги\n";
    }

    public function safeDown()
    {
        // Удаляем добавленные книги по ISBN
        $isbns = [
            '978-5-17-098354-3', '978-5-17-098355-0', '978-5-17-098356-7', // Толстой
            '978-5-17-098357-4', '978-5-17-098358-1', '978-5-17-098359-8', '978-5-17-098360-4', // Достоевский
            '978-5-17-098361-1', '978-5-17-098362-8', '978-5-17-098363-5', '978-5-17-098364-2', '978-5-17-098365-9', // Чехов
            '978-5-17-098366-6', '978-5-17-098367-3', '978-5-17-098368-0', '978-5-17-098369-7', '978-5-17-098370-3', // Пушкин
            '978-5-17-098371-0', '978-5-17-098372-7', '978-5-17-098373-4', '978-5-17-098374-1', // Лермонтов
            '978-5-17-098375-8', // Сборник
        ];

        foreach ($isbns as $isbn) {
            $this->delete('{{%book}}', ['isbn' => $isbn]);
        }

        echo "Тестовые данные удалены\n";
    }
}

